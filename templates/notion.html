{% extends "base.html" %}

{% block title %}ë…¸ì…˜ ë¬¸ì„œ ì‘ì„± - Gemini Auto{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-9"> <h2 class="mb-4 fw-bold">ğŸ“ ë…¸ì…˜ ë§ˆí¬ë‹¤ìš´ ìƒì„±ê¸°</h2>

        {% if not result %}
        <div class="card p-4 shadow-sm border-0">
            <form method="POST" onsubmit="showLoading()">
                <div class="mb-4">
                    <label for="topic" class="form-label fw-bold">ì‘ì„±í•  ì£¼ì œë‚˜ í‚¤ì›Œë“œ</label>
                    <input type="text" class="form-control form-control-lg" id="topic" name="topic" placeholder="ì˜ˆ: ë‹¤ìŒ ì£¼ ë„ì¿„ ì—¬í–‰ ê³„íš, ì‹ ê·œ í”„ë¡œì íŠ¸ ê¸°íšì•ˆ..." required>
                </div>
                <div class="d-grid">
                    <button type="submit" id="btnSubmit" class="btn btn-primary btn-lg">ë¬¸ì„œ ìƒì„±í•˜ê¸° âœ¨</button>
                    <button type="button" id="btnLoading" class="btn btn-secondary btn-lg" style="display:none;" disabled>
                        <span class="spinner-border spinner-border-sm me-2"></span>AIê°€ ë¬¸ì„œë¥¼ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤...
                    </button>
                </div>
            </form>
        </div>
        {% endif %}

        {% if result %}
        <div class="card p-4 shadow-sm border-success">
            <h4 class="text-success mb-3">âœ… ìƒì„± ì™„ë£Œ!</h4>
            
            <p class="text-muted">ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ ë…¸ì…˜ì— ë¶™ì—¬ë„£ê±°ë‚˜(.md) íŒŒì¼ë¡œ ì €ì¥í•˜ì„¸ìš”.</p>
            
            <textarea 
                id="resultText" 
                class="form-control mb-3 bg-light" 
                style="min-height: 500px; resize: vertical; overflow-y: hidden;"
                readonly
            >{{ result }}</textarea>
            
            <div class="d-flex gap-2">
                <button onclick="copyToClipboard()" class="btn btn-dark flex-grow-1 py-2">
                    ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬
                </button>
                <button onclick="downloadMarkdown()" class="btn btn-outline-success flex-grow-1 py-2">
                    ğŸ’¾ .md íŒŒì¼ë¡œ ì €ì¥
                </button>
            </div>
            
            <div class="mt-4 text-end">
                <a href="/notion" class="text-decoration-none fw-bold">ğŸ”„ ë‹¤ë¥¸ ì£¼ì œë¡œ ë‹¤ì‹œ ë§Œë“¤ê¸°</a>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
    // 0. í™”ë©´ ë¡œë“œ ì‹œ í…ìŠ¤íŠ¸ ìƒì ë†’ì´ ìë™ ì¡°ì ˆ (í•µì‹¬ ê¸°ëŠ¥)
    window.onload = function() {
        const textarea = document.getElementById("resultText");
        if (textarea) {
            // ë‚´ìš©ì— ë§ì¶° ë†’ì´ ëŠ˜ë¦¬ê¸° (ë‚´ìš© + ì•½ê°„ì˜ ì—¬ìœ )
            textarea.style.height = "auto";
            textarea.style.height = (textarea.scrollHeight + 10) + "px";
        }
    };

    // 1. ë¡œë”© í‘œì‹œ
    function showLoading() {
        document.getElementById('btnSubmit').style.display = 'none';
        document.getElementById('btnLoading').style.display = 'block';
    }

    // 2. í´ë¦½ë³´ë“œ ë³µì‚¬ ê¸°ëŠ¥
    function copyToClipboard() {
        const copyText = document.getElementById("resultText");
        copyText.select();
        navigator.clipboard.writeText(copyText.value).then(() => {
            alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ë…¸ì…˜ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V) í•˜ì„¸ìš”.");
        });
    }

    // 3. .md íŒŒì¼ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
    function downloadMarkdown() {
        const text = document.getElementById("resultText").value;
        const blob = new Blob([text], { type: "text/markdown" });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement("a");
        a.href = url;
        a.download = "notion_doc.md";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
</script>
{% endblock %}