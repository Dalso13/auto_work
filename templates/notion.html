{% extends "base.html" %}

{% block title %}ë…¸ì…˜ ë¬¸ì„œ ì‘ì„± - Gemini Auto{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-9">
        <h2 class="mb-4 fw-bold">ğŸ“ ë…¸ì…˜ ë§ˆí¬ë‹¤ìš´ ìƒì„±ê¸°</h2>

        {% if not result %}
        <div class="card p-4 shadow-sm border-0">
            <form method="POST" onsubmit="showLoading()">
                <div class="mb-4">
                    <label for="topic" class="form-label fw-bold">ì‘ì„±í•  ì£¼ì œë‚˜ ìš”êµ¬ì‚¬í•­</label>
                    
                    <textarea 
                        class="form-control form-control-lg bg-light" 
                        id="topic" 
                        name="topic" 
                        rows="4" 
                        placeholder="ì˜ˆì‹œ:&#13;&#10;- ë‹¤ìŒ ì£¼ ë„ì¿„ 2ë°• 3ì¼ ì—¬í–‰ ê³„íš ì§œì¤˜&#13;&#10;- ë§›ì§‘ì´ë‘ ì‡¼í•‘ ìœ„ì£¼ë¡œ&#13;&#10;- ì‹ ê·œ í”„ë¡œì íŠ¸ ê¸°íšì•ˆ ì´ˆì•ˆ ì‘ì„±í•´ì¤˜" 
                        required
                        oninput="autoResize(this)"
                        style="resize: none; overflow-y: hidden;"
                    ></textarea>
                </div>
                <div class="d-grid">
                    <button type="submit" id="btnSubmit" class="btn btn-primary btn-lg">ë¬¸ì„œ ìƒì„±í•˜ê¸° âœ¨</button>
                    <button type="button" id="btnLoading" class="btn btn-secondary btn-lg" style="display:none;" disabled>
                        <span class="spinner-border spinner-border-sm me-2"></span>AIê°€ ë¬¸ì„œë¥¼ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤...
                    </button>
                </div>
            </form>
        </div>
        {% endif %}

        {% if result %}
        <div class="card p-4 shadow-sm border-success">
            <h4 class="text-success mb-3">âœ… ìƒì„± ì™„ë£Œ!</h4>
            <p class="text-muted">ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ ë…¸ì…˜ì— ë¶™ì—¬ë„£ê±°ë‚˜(.md) íŒŒì¼ë¡œ ì €ì¥í•˜ì„¸ìš”.</p>
            <textarea id="resultText" class="form-control mb-3 bg-light" style="min-height: 500px;" readonly>{{ result }}</textarea>
            <div class="d-flex gap-2">
                <button onclick="copyToClipboard()" class="btn btn-dark flex-grow-1 py-2">ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬</button>
                <button onclick="downloadMarkdown()" class="btn btn-outline-success flex-grow-1 py-2">ğŸ’¾ .md íŒŒì¼ë¡œ ì €ì¥</button>
            </div>
            <div class="mt-4 text-end">
                <a href="/notion" class="text-decoration-none fw-bold">ğŸ”„ ë‹¤ë¥¸ ì£¼ì œë¡œ ë‹¤ì‹œ ë§Œë“¤ê¸°</a>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
// 1. ì…ë ¥ì°½ ìë™ ë†’ì´ ì¡°ì ˆ í•¨ìˆ˜ (í™”ë©´ íŠ€ëŠ” í˜„ìƒ ìˆ˜ì •ë²„ì „)
    function autoResize(textarea) {
        // [ìˆ˜ì •] í˜„ì¬ í™”ë©´ì˜ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
        const currentScrollPosition = window.scrollY;

        // ë†’ì´ ì¬ê³„ì‚°
        textarea.style.height = 'auto';
        textarea.style.height = (textarea.scrollHeight) + 'px';

        // [ìˆ˜ì •] ì €ì¥í•´ë‘” ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¡œ ê°•ì œ ë³µêµ¬í•©ë‹ˆë‹¤.
        window.scrollTo(window.scrollX, currentScrollPosition);
    }

    // 2. ë¡œë”© í‘œì‹œ
    function showLoading() {
        document.getElementById('btnSubmit').style.display = 'none';
        document.getElementById('btnLoading').style.display = 'block';
    }

    function copyToClipboard() {
        const copyText = document.getElementById("resultText");
        copyText.select();
        navigator.clipboard.writeText(copyText.value).then(() => {
            alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ë…¸ì…˜ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V) í•˜ì„¸ìš”.");
        });
    }

    function downloadMarkdown() {
        const text = document.getElementById("resultText").value;
        const blob = new Blob([text], { type: "text/markdown" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "notion_doc.md";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
</script>
{% endblock %}