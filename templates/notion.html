{% extends "base.html" %}

{% block title %}ë…¸ì…˜ ë¬¸ì„œ ì‘ì„± - Gemini Auto{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <h2 class="mb-4">ğŸ“ ë…¸ì…˜ ë§ˆí¬ë‹¤ìš´ ìƒì„±ê¸°</h2>

        {% if not result %}
        <div class="card p-4 shadow-sm">
            <form method="POST">
                <div class="mb-3">
                    <label for="topic" class="form-label">ì‘ì„±í•  ì£¼ì œë‚˜ í‚¤ì›Œë“œ:</label>
                    <input type="text" class="form-control form-control-lg" id="topic" name="topic" placeholder="ì˜ˆ: ë‹¤ìŒ ì£¼ ë„ì¿„ ì—¬í–‰ ê³„íš, ì‹ ê·œ í”„ë¡œì íŠ¸ ê¸°íšì•ˆ..." required>
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">ë¬¸ì„œ ìƒì„±í•˜ê¸° âœ¨</button>
                </div>
            </form>
        </div>
        {% endif %}

        {% if result %}
        <div class="card p-4 shadow-sm border-success">
            <h4 class="text-success mb-3">âœ… ìƒì„± ì™„ë£Œ!</h4>
            
            <p class="text-muted">ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ ë…¸ì…˜ì— ë¶™ì—¬ë„£ê±°ë‚˜(.md) íŒŒì¼ë¡œ ì €ì¥í•˜ì„¸ìš”.</p>
            
            <textarea id="resultText" class="form-control mb-3 bg-light" rows="10">{{ result }}</textarea>
            
            <div class="d-flex gap-2">
                <button onclick="copyToClipboard()" class="btn btn-dark flex-grow-1">
                    ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬
                </button>
                <button onclick="downloadMarkdown()" class="btn btn-outline-success flex-grow-1">
                    ğŸ’¾ .md íŒŒì¼ë¡œ ì €ì¥
                </button>
            </div>
            
            <div class="mt-3 text-end">
                <a href="/notion" class="text-decoration-none">ğŸ”„ ë‹¤ì‹œ ë§Œë“¤ê¸°</a>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
    // 1. í´ë¦½ë³´ë“œ ë³µì‚¬ ê¸°ëŠ¥
    function copyToClipboard() {
        const copyText = document.getElementById("resultText");
        copyText.select();
        navigator.clipboard.writeText(copyText.value).then(() => {
            alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ë…¸ì…˜ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V) í•˜ì„¸ìš”.");
        });
    }

    // 2. .md íŒŒì¼ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ (ì„œë²„ ìš”ì²­ ì—†ì´ ë¸Œë¼ìš°ì €ì—ì„œ ì¦‰ì‹œ ìƒì„±)
    function downloadMarkdown() {
        const text = document.getElementById("resultText").value;
        const blob = new Blob([text], { type: "text/markdown" });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement("a");
        a.href = url;
        a.download = "notion_doc.md"; // íŒŒì¼ëª…
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
</script>
{% endblock %}